# Краткий отчет по замечаниям из otchet.md

## Актуальные замечания

1. **Глобальные переменные `orchestrator` и `registry` в `api.py`**
   - В файле `api.py` все еще используются глобальные переменные для `orchestrator` и `registry`, что может привести к проблемам при параллельных запросах.

2. **Создание нового `DeepAgentOrchestrator` для каждого запроса `/run`**
   - В методе `run_task` каждый раз создается новый экземпляр оркестратора, что может привести к снижению производительности.

3. **Отсутствие типизации и валидации для `custom_tools`**
   - В `OrchestratorConfig` поле `custom_tools` определено как `List = field(default_factory=list)` без конкретного типа, что затрудняет проверку корректности передачи инструментов.

4. **Логи пишутся без конфигурации logger-а**
   - В точке входа нет вызова `logging.basicConfig()`, что может привести к тому, что сообщения не будут отображаться.

5. **`api.py` возвращает `RunResponse` c `stream_url` но в `websocket_run` всегда вызывается `orchestrator.stream("", thread_id)`**
   - В `websocket_run` передается пустая строка вместо реальной задачи, что приводит к пустому потоку.

6. **`api.run_task` не закрывает ранее созданный оркестратор**
   - Новый оркестратор создается для каждого запроса, и предыдущий не освобождается явным образом, что может привести к утечкам ресурсов.


частично верные замечания

1. **Hot-reload реализован через watchdog, но never started**
   - В `agent_registry.py` есть реализация hot-reload, и метод `enable_hot_reload` существует, но в `api.py` он действительно не вызывается. Однако это скорее недоработка, чем полностью неверное замечание.

2. **`apply_env_overrides` меняет `settings.model.name` но `ModelConfig.provider` оставляет "anthropic"**
   - В `config.py` есть логика для применения переменных окружения, но провайдер не изменяется автоматически. Это частично исправлено, так как логика существует, но не полностью автоматизирована.